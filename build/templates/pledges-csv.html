<!DOCTYPE html><html><head><title>MayOne.us - SuperPAC to end all SuperPacs. Mayday for the Republic.</title><link rel="stylesheet" href="/static/reset.css"><link rel="stylesheet" href="/static/common.css"><link rel="stylesheet" href="/static/style.css"><link rel="stylesheet" href="/static/v9green.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:400,700,400italic"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Questrial"><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:image" content="/static/share_preview.jpg"/>
<meta property="og:title" content="MAYDAY: Democracy needs an upgrade. Act now."/>
<meta property="og:description" content="Money has corrupted politics. Weâ€™re kickstarting a political experiment big enough to win a Congress committed to fundamental reform -- Join us!"/>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel="stylesheet" id="googlefonts-css" href="https://fonts.googleapis.com/css?family=Oswald:300,400,700|Lato:400,700&amp;subset=latin" type="text/css" media="all"><script src="//cdn.optimizely.com/js/210578001.js"></script>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');


 ga('create', 'UA-50367295-1', 'mayday.us');
 ga('require', 'displayfeatures');

 // Optimizely Universal Analytics Integration
 window.optimizely = window.optimizely || [];
 window.optimizely.push("activateUniversalAnalytics");

 ga('send', 'pageview');

</script>
<link rel="stylesheet" href="/static/admin/pickadate.js/default.css"><link rel="stylesheet" href="/static/admin/pickadate.js/default.date.css"><script src="//code.jquery.com/jquery-1.11.0.min.js"></script><script src="/static/admin/pickadate.js/picker.js"></script><script src="/static/admin/pickadate.js/picker.date.js"></script><script src="/static/admin/pickadate.js/legacy.js"></script><script type="text/javascript">var PARALLELISM = 10;
// we could just iterate over the keys, but we want a specific order
var headers = [
  'Source',
  'Donation Date',
  'Amount ($)',
  'Plege url_nonce',
  'Payer Identifier',
  'Email',
  'User url_nonce', 
  'First Name',
  'Last Name',
  'Address',
  'Address 2',
  'City',
  'State',
  'ZIP Code',
  'Country',
  'Occupation',
  'Employer',
  'Targeting',
  'Type',
  'Recurring'
];
function escapeValue(v){
  if (v === null) {
    return "";
  }
  if (typeof(v) === 'string'){
    // escape quotes with a double
    v = v.replace(/"/g, '""');
    // quote string if it contains a quote, comma, or newline
    var hasComma = v.indexOf(',') > -1;
    var hadQuote = v.indexOf('"') > -1;
    var hasNewline = v.indexOf('\n') > -1;
    if (hasComma || hadQuote || hasNewline) {
      v = '"' + v + '"';
    }
  }
  return v;
}
function outputCSV(pledges){
  $('.status').html('Done downloading ' + pledges.length + ' pledges!')
  var header = '"' + headers.join('","') + '"';
  var body = $.map(pledges, function(pledge){
    return $.map(headers, function(header){
      return escapeValue(pledge[header]);
    }).join();
  }).join('\r\n');
  var csv = [header, body].join('\r\n');
  a = $('<a>Download CSV</a>');
  $('#csv-download').append(a);
  var href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
  a.attr("href", href).attr("download", "pledges.csv");
  $('#csv-download').append('<pre>'+csv+'</pre>');
}

var pledges = [];
function getChunk(startDate, endDate, cursor){
  $('.status').html('Exported ' + pledges.length + ' pledges...')
  options = {};
  if (!!startDate){
    options.start_date = startDate;
  }
  if (!!endDate){
    options.end_date = endDate;
  }
  if (!!cursor){
    options.cursor = cursor;
  }
  $.getJSON("/admin/pledges_export/pledges.json", options, function(data) {
    $.each(data.pledges, function(i, pledge){
      pledges.push(pledge);
    });
    if (data.pledges.length){
      getChunk(startDate, endDate, data.next_cursor);
    } else {
      outputCSV(pledges);
    }
  });
}

$(function(){
  $('#csv-download button').one('click', function(){
    $(this).remove();
    this.disabled = true;
    $('#start-date').hide();
    $('#end-date').hide();
    var startDate = $('#start-date_hidden').val();
    var endDate = $('#end-date_hidden').val();
    getChunk(startDate, endDate);
  });
  var pickadateOptions = {
    formatSubmit: 'yyyy-mm-dd',
    hiddenName: true
  };
  $('#start-date').pickadate(pickadateOptions);
  $('#end-date').pickadate(pickadateOptions);
});
</script></head><body id="user-update"><div class="container"><div class="page-header"><h1>Generate CSV Downlaod</h1></div><div class="row"><div class="col-md-8 col-md-offset-2"><h2>CSV</h2><div id="csv-download"><div class="row"><div class="col-md-6"><input id="start-date" placeholder="Start date (optional)"></div><div class="col-md-6"><input id="end-date" placeholder="End date (optional)"></div></div><button>Start Generating CSV Download</button><div class="status"></div></div></div></div></div></body></html>